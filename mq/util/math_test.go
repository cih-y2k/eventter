package util

import (
	"fmt"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestNextPowerOf2(t *testing.T) {
	tests := []struct {
		n        uint32
		expected uint32
	}{
		{0, 0},
		{1, 1},
		{2, 2},
		{3, 4},
		{1 << 2, 1 << 2},
		{1<<2 + 1, 1 << 3},
		{1<<3 - 1, 1 << 3},
		{1 << 3, 1 << 3},
		{1<<3 + 1, 1 << 4},
		{1<<4 - 1, 1 << 4},
		{1 << 4, 1 << 4},
		{1<<4 + 1, 1 << 5},
		{1<<5 - 1, 1 << 5},
		{1 << 5, 1 << 5},
		{1<<5 + 1, 1 << 6},
		{1<<6 - 1, 1 << 6},
		{1 << 6, 1 << 6},
		{1<<6 + 1, 1 << 7},
		{1<<7 - 1, 1 << 7},
		{1 << 7, 1 << 7},
		{1<<7 + 1, 1 << 8},
		{1<<8 - 1, 1 << 8},
		{1 << 8, 1 << 8},
		{1<<8 + 1, 1 << 9},
		{1<<9 - 1, 1 << 9},
		{1 << 9, 1 << 9},
		{1<<9 + 1, 1 << 10},
		{1<<10 - 1, 1 << 10},
		{1 << 10, 1 << 10},
		{1<<10 + 1, 1 << 11},
		{1<<11 - 1, 1 << 11},
		{1 << 11, 1 << 11},
		{1<<11 + 1, 1 << 12},
		{1<<12 - 1, 1 << 12},
		{1 << 12, 1 << 12},
		{1<<12 + 1, 1 << 13},
		{1<<13 - 1, 1 << 13},
		{1 << 13, 1 << 13},
		{1<<13 + 1, 1 << 14},
		{1<<14 - 1, 1 << 14},
		{1 << 14, 1 << 14},
		{1<<14 + 1, 1 << 15},
		{1<<15 - 1, 1 << 15},
		{1 << 15, 1 << 15},
		{1<<15 + 1, 1 << 16},
		{1<<16 - 1, 1 << 16},
		{1 << 16, 1 << 16},
		{1<<16 + 1, 1 << 17},
		{1<<17 - 1, 1 << 17},
		{1 << 17, 1 << 17},
		{1<<17 + 1, 1 << 18},
		{1<<18 - 1, 1 << 18},
		{1 << 18, 1 << 18},
		{1<<18 + 1, 1 << 19},
		{1<<19 - 1, 1 << 19},
		{1 << 19, 1 << 19},
		{1<<19 + 1, 1 << 20},
		{1<<20 - 1, 1 << 20},
		{1 << 20, 1 << 20},
		{1<<20 + 1, 1 << 21},
		{1<<21 - 1, 1 << 21},
		{1 << 21, 1 << 21},
		{1<<21 + 1, 1 << 22},
		{1<<22 - 1, 1 << 22},
		{1 << 22, 1 << 22},
		{1<<22 + 1, 1 << 23},
		{1<<23 - 1, 1 << 23},
		{1 << 23, 1 << 23},
		{1<<23 + 1, 1 << 24},
		{1<<24 - 1, 1 << 24},
		{1 << 24, 1 << 24},
		{1<<24 + 1, 1 << 25},
		{1<<25 - 1, 1 << 25},
		{1 << 25, 1 << 25},
		{1<<25 + 1, 1 << 26},
		{1<<26 - 1, 1 << 26},
		{1 << 26, 1 << 26},
		{1<<26 + 1, 1 << 27},
		{1<<27 - 1, 1 << 27},
		{1 << 27, 1 << 27},
		{1<<27 + 1, 1 << 28},
		{1<<28 - 1, 1 << 28},
		{1 << 28, 1 << 28},
		{1<<28 + 1, 1 << 29},
		{1<<29 - 1, 1 << 29},
		{1 << 29, 1 << 29},
		{1<<29 + 1, 1 << 30},
		{1<<30 - 1, 1 << 30},
		{1 << 30, 1 << 30},
		{1<<30 + 1, 1 << 31},
		{1<<31 - 1, 1 << 31},
		{1 << 31, 1 << 31},
	}

	for _, test := range tests {
		t.Run(fmt.Sprintf("%d", test.n), func(t *testing.T) {
			assert := require.New(t)
			assert.Equal(test.expected, NextPowerOfTwo32(test.n))
		})
	}
}
